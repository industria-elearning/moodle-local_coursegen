{"version":3,"file":"course_streaming.min.js","sources":["../src/course_streaming.js"],"sourcesContent":["/* eslint-disable */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course Streaming Module for handling real-time course generation\n *\n * @module     local_datacurso/course_streaming\n * @copyright  2025 Buendata <soluciones@buendata.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nfunction typeWriter(element, text, speed) {\n  return new Promise((resolve) => {\n    let i = 0;\n    function typing() {\n      if (i < text.length) {\n        element.textContent += text.charAt(i);\n        i++;\n        setTimeout(typing, speed);\n      } else {\n        resolve();\n      }\n    }\n    typing();\n  });\n}\n\n/**\n * Start course streaming from the provided URL\n * @param {string} streamingUrl - The EventSource URL for streaming\n * @param {Element} container - Container element for displaying results\n * @returns {Promise} Promise that resolves when streaming is complete\n */\nexport const startStreaming = async (streamingUrl, container) => {\n    const progressIndicator = document.getElementById(\"progress-indicator\");\n    const eventList = container.querySelector(\"[data-region='local_datacurso/course_streaming']\");\n    const progressIcon = document.getElementById(\"progress-icon\");\n  \n    eventList.innerHTML = \"\";\n    progressIndicator.style.display = \"block\";\n  \n    const evtSource = new EventSource(streamingUrl);\n  \n    evtSource.onmessage = async (event) => {\n      const data = JSON.parse(event.data);\n      console.log(\"Received:\", data);\n  \n      switch (data.type) {\n        case \"section_start\":\n          const sectionHeader = document.createElement(\"div\");\n          sectionHeader.className = \"mb-3\";\n          eventList.appendChild(sectionHeader);\n  \n          const title = document.createElement(\"h3\");\n          title.className = \"mb-2\";\n          sectionHeader.appendChild(title);\n          await typeWriter(\n            title,\n            `Sección ${data.section.section}: ${data.section.title}`,\n            20\n          );\n  \n          const details = document.createElement(\"ul\");\n          details.className = \"mb-2 pl-3\";\n          sectionHeader.appendChild(details);\n  \n          const hours = document.createElement(\"li\");\n          details.appendChild(hours);\n          await typeWriter(\n            hours,\n            `Horas teóricas: ${data.section.ht_hours} | Horas autónomas: ${data.section.had_hours}`,\n            15\n          );\n  \n          const objectives = document.createElement(\"li\");\n          details.appendChild(objectives);\n          await typeWriter(\n            objectives,\n            `Objetivos: ${data.section.objectives}`,\n            10\n          );\n          break;\n  \n        case \"activity\":\n          const activityItem = document.createElement(\"ul\");\n          activityItem.className = \"ml-4 mb-2\";\n          eventList.appendChild(activityItem);\n  \n          const activityLine = document.createElement(\"li\");\n          activityItem.appendChild(activityLine);\n  \n          const activityTitle = document.createElement(\"strong\");\n          activityLine.appendChild(activityTitle);\n          await typeWriter(activityTitle, data.activity.title, 25);\n  \n          const activityDesc = document.createElement(\"span\");\n          activityLine.appendChild(activityDesc);\n          await typeWriter(activityDesc, `: ${data.activity.description}`, 8);\n  \n          const resourceType = document.createElement(\"em\");\n          resourceType.textContent = ` (${data.activity.resource_type})`;\n          activityLine.appendChild(resourceType);\n          break;\n  \n        case \"section_end\":\n          const separator = document.createElement(\"hr\");\n          eventList.appendChild(separator);\n          break;\n  \n        case \"complete\":\n          progressIcon.innerHTML = `\n              <div class=\"bg-success rounded-circle d-flex align-items-center justify-content-center\" style=\"width: 1.5rem; height: 1.5rem;\">\n                <i class=\"text-white\" style=\"font-size: 0.8rem;\">✓</i>\n              </div>\n            `;\n          const completionMsg = document.createElement(\"div\");\n          completionMsg.className = \"mt-4 text-center\";\n          eventList.appendChild(completionMsg);\n          await typeWriter(completionMsg, \"✅ Plan del curso completado\", 50);\n          evtSource.close();\n          break;\n      }\n    };\n  }\n  \n"],"names":["typeWriter","element","text","speed","Promise","resolve","i","typing","length","textContent","charAt","setTimeout","async","streamingUrl","container","progressIndicator","document","getElementById","eventList","querySelector","progressIcon","innerHTML","style","display","evtSource","EventSource","onmessage","data","JSON","parse","event","console","log","type","sectionHeader","createElement","className","appendChild","title","section","details","hours","ht_hours","had_hours","objectives","activityItem","activityLine","activityTitle","activity","activityDesc","description","resourceType","resource_type","separator","completionMsg","close"],"mappings":";;;;;;;;SAwBSA,WAAWC,QAASC,KAAMC,cAC1B,IAAIC,SAASC,cACdC,EAAI,YACCC,SACHD,EAAIJ,KAAKM,QACXP,QAAQQ,aAAeP,KAAKQ,OAAOJ,GACnCA,IACAK,WAAWJ,OAAQJ,QAEnBE,UAGJE,qHAU0BK,MAAOC,aAAcC,mBACzCC,kBAAoBC,SAASC,eAAe,sBAC5CC,UAAYJ,UAAUK,cAAc,oDACpCC,aAAeJ,SAASC,eAAe,iBAE7CC,UAAUG,UAAY,GACtBN,kBAAkBO,MAAMC,QAAU,cAE5BC,UAAY,IAAIC,YAAYZ,cAElCW,UAAUE,UAAYd,MAAAA,cACde,KAAOC,KAAKC,MAAMC,MAAMH,aAC9BI,QAAQC,IAAI,YAAaL,MAEjBA,KAAKM,UACN,sBACGC,cAAgBlB,SAASmB,cAAc,OAC7CD,cAAcE,UAAY,OAC1BlB,UAAUmB,YAAYH,qBAEhBI,MAAQtB,SAASmB,cAAc,MACrCG,MAAMF,UAAY,OAClBF,cAAcG,YAAYC,aACpBtC,WACJsC,wBACWX,KAAKY,QAAQA,qBAAYZ,KAAKY,QAAQD,OACjD,UAGIE,QAAUxB,SAASmB,cAAc,MACvCK,QAAQJ,UAAY,YACpBF,cAAcG,YAAYG,eAEpBC,MAAQzB,SAASmB,cAAc,MACrCK,QAAQH,YAAYI,aACdzC,WACJyC,gCACmBd,KAAKY,QAAQG,wCAA+Bf,KAAKY,QAAQI,WAC5E,UAGIC,WAAa5B,SAASmB,cAAc,MAC1CK,QAAQH,YAAYO,kBACd5C,WACJ4C,gCACcjB,KAAKY,QAAQK,YAC3B,cAIC,iBACGC,aAAe7B,SAASmB,cAAc,MAC5CU,aAAaT,UAAY,YACzBlB,UAAUmB,YAAYQ,oBAEhBC,aAAe9B,SAASmB,cAAc,MAC5CU,aAAaR,YAAYS,oBAEnBC,cAAgB/B,SAASmB,cAAc,UAC7CW,aAAaT,YAAYU,qBACnB/C,WAAW+C,cAAepB,KAAKqB,SAASV,MAAO,UAE/CW,aAAejC,SAASmB,cAAc,QAC5CW,aAAaT,YAAYY,oBACnBjD,WAAWiD,yBAAmBtB,KAAKqB,SAASE,aAAe,SAE3DC,aAAenC,SAASmB,cAAc,MAC5CgB,aAAa1C,wBAAmBkB,KAAKqB,SAASI,mBAC9CN,aAAaT,YAAYc,wBAGtB,oBACGE,UAAYrC,SAASmB,cAAc,MACzCjB,UAAUmB,YAAYgB,qBAGnB,WACHjC,aAAaC,8QAKPiC,cAAgBtC,SAASmB,cAAc,OAC7CmB,cAAclB,UAAY,mBAC1BlB,UAAUmB,YAAYiB,qBAChBtD,WAAWsD,cAAe,8BAA+B,IAC/D9B,UAAU+B"}
{"version":3,"file":"course_streaming.min.js","sources":["../src/course_streaming.js"],"sourcesContent":["/* eslint-disable */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course Streaming Module for handling real-time course generation\n *\n * @module     local_datacurso/course_streaming\n * @copyright  2025 Buendata <soluciones@buendata.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nfunction typeWriter(element, text, speed) {\n  return new Promise((resolve) => {\n    let i = 0;\n    function typing() {\n      if (i < text.length) {\n        element.textContent += text.charAt(i);\n        i++;\n        setTimeout(typing, speed);\n      } else {\n        resolve();\n      }\n    }\n    typing();\n  });\n}\n\n/**\n * Start course streaming from the provided URL\n * @param {string} streamingUrl - The EventSource URL for streaming\n * @param {Element} container - Container element for displaying results\n * @returns {Promise} Promise that resolves when streaming is complete\n */\nexport const startStreaming = async (streamingUrl, container) => {\n    const progressIndicator = container.querySelector(\"[data-region='local_datacurso/course_streaming/progress']\");\n    const eventList = container.querySelector(\"[data-region='local_datacurso/course_streaming']\");\n    const progressIcon = container.querySelector(\"[data-region='local_datacurso/course_streaming/progress/icon']\");\n  \n    eventList.innerHTML = \"\";\n    if (progressIndicator) {\n      progressIndicator.style.display = \"block\";\n    }\n  \n    const evtSource = new EventSource(streamingUrl);\n  \n    evtSource.onmessage = async (event) => {\n      const data = JSON.parse(event.data);\n  \n      switch (data.type) {\n        case \"section_start\":\n          const sectionHeader = document.createElement(\"div\");\n          sectionHeader.className = \"mb-3\";\n          eventList.appendChild(sectionHeader);\n  \n          const title = document.createElement(\"h3\");\n          title.className = \"mb-2\";\n          sectionHeader.appendChild(title);\n          await typeWriter(\n            title,\n            `Sección ${data.section.section}: ${data.section.title}`,\n            20\n          );\n  \n          const details = document.createElement(\"ul\");\n          details.className = \"mb-2 pl-3\";\n          sectionHeader.appendChild(details);\n  \n          const hours = document.createElement(\"li\");\n          details.appendChild(hours);\n          await typeWriter(\n            hours,\n            `Horas teóricas: ${data.section.ht_hours} | Horas autónomas: ${data.section.had_hours}`,\n            15\n          );\n  \n          const objectives = document.createElement(\"li\");\n          details.appendChild(objectives);\n          await typeWriter(\n            objectives,\n            `Objetivos: ${data.section.objectives}`,\n            10\n          );\n          break;\n  \n        case \"activity\":\n          const activityItem = document.createElement(\"ul\");\n          activityItem.className = \"ml-4 mb-2\";\n          eventList.appendChild(activityItem);\n  \n          const activityLine = document.createElement(\"li\");\n          activityItem.appendChild(activityLine);\n  \n          const activityTitle = document.createElement(\"strong\");\n          activityLine.appendChild(activityTitle);\n          await typeWriter(activityTitle, data.activity.title, 25);\n  \n          const activityDesc = document.createElement(\"span\");\n          activityLine.appendChild(activityDesc);\n          await typeWriter(activityDesc, `: ${data.activity.description}`, 8);\n  \n          const resourceType = document.createElement(\"em\");\n          resourceType.textContent = ` (${data.activity.resource_type})`;\n          activityLine.appendChild(resourceType);\n          break;\n  \n        case \"section_end\":\n          const separator = document.createElement(\"hr\");\n          eventList.appendChild(separator);\n          break;\n  \n        case \"complete\":\n          if (progressIcon) {\n            progressIcon.innerHTML = `\n              <div class=\"bg-success rounded-circle d-flex align-items-center justify-content-center\" style=\"width: 1.5rem; height: 1.5rem;\">\n                <i class=\"text-white\" style=\"font-size: 0.8rem;\">✓</i>\n              </div>\n            `;\n          }\n          \n          // Show planning action buttons when streaming completes\n          const planningActions = document.getElementById('course-planning-actions');\n          if (planningActions) {\n            planningActions.style.display = 'block';\n          }\n          \n          evtSource.close();\n          break;\n      }\n    };\n  }\n  \n"],"names":["typeWriter","element","text","speed","Promise","resolve","i","typing","length","textContent","charAt","setTimeout","async","streamingUrl","container","progressIndicator","querySelector","eventList","progressIcon","innerHTML","style","display","evtSource","EventSource","onmessage","data","JSON","parse","event","type","sectionHeader","document","createElement","className","appendChild","title","section","details","hours","ht_hours","had_hours","objectives","activityItem","activityLine","activityTitle","activity","activityDesc","description","resourceType","resource_type","separator","planningActions","getElementById","close"],"mappings":";;;;;;;;SAwBSA,WAAWC,QAASC,KAAMC,cAC1B,IAAIC,SAASC,cACdC,EAAI,YACCC,SACHD,EAAIJ,KAAKM,QACXP,QAAQQ,aAAeP,KAAKQ,OAAOJ,GACnCA,IACAK,WAAWJ,OAAQJ,QAEnBE,UAGJE,qHAU0BK,MAAOC,aAAcC,mBACzCC,kBAAoBD,UAAUE,cAAc,6DAC5CC,UAAYH,UAAUE,cAAc,oDACpCE,aAAeJ,UAAUE,cAAc,kEAE7CC,UAAUE,UAAY,GAClBJ,oBACFA,kBAAkBK,MAAMC,QAAU,eAG9BC,UAAY,IAAIC,YAAYV,cAElCS,UAAUE,UAAYZ,MAAAA,cACda,KAAOC,KAAKC,MAAMC,MAAMH,aAEtBA,KAAKI,UACN,sBACGC,cAAgBC,SAASC,cAAc,OAC7CF,cAAcG,UAAY,OAC1BhB,UAAUiB,YAAYJ,qBAEhBK,MAAQJ,SAASC,cAAc,MACrCG,MAAMF,UAAY,OAClBH,cAAcI,YAAYC,aACpBnC,WACJmC,wBACWV,KAAKW,QAAQA,qBAAYX,KAAKW,QAAQD,OACjD,UAGIE,QAAUN,SAASC,cAAc,MACvCK,QAAQJ,UAAY,YACpBH,cAAcI,YAAYG,eAEpBC,MAAQP,SAASC,cAAc,MACrCK,QAAQH,YAAYI,aACdtC,WACJsC,gCACmBb,KAAKW,QAAQG,wCAA+Bd,KAAKW,QAAQI,WAC5E,UAGIC,WAAaV,SAASC,cAAc,MAC1CK,QAAQH,YAAYO,kBACdzC,WACJyC,gCACchB,KAAKW,QAAQK,YAC3B,cAIC,iBACGC,aAAeX,SAASC,cAAc,MAC5CU,aAAaT,UAAY,YACzBhB,UAAUiB,YAAYQ,oBAEhBC,aAAeZ,SAASC,cAAc,MAC5CU,aAAaR,YAAYS,oBAEnBC,cAAgBb,SAASC,cAAc,UAC7CW,aAAaT,YAAYU,qBACnB5C,WAAW4C,cAAenB,KAAKoB,SAASV,MAAO,UAE/CW,aAAef,SAASC,cAAc,QAC5CW,aAAaT,YAAYY,oBACnB9C,WAAW8C,yBAAmBrB,KAAKoB,SAASE,aAAe,SAE3DC,aAAejB,SAASC,cAAc,MAC5CgB,aAAavC,wBAAmBgB,KAAKoB,SAASI,mBAC9CN,aAAaT,YAAYc,wBAGtB,oBACGE,UAAYnB,SAASC,cAAc,MACzCf,UAAUiB,YAAYgB,qBAGnB,WACChC,eACFA,aAAaC,+QAQTgC,gBAAkBpB,SAASqB,eAAe,2BAC5CD,kBACFA,gBAAgB/B,MAAMC,QAAU,SAGlCC,UAAU+B"}
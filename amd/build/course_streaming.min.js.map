{"version":3,"file":"course_streaming.min.js","sources":["../src/course_streaming.js"],"sourcesContent":["/* eslint-disable */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course Streaming Module for handling real-time course generation\n *\n * @module     local_datacurso/course_streaming\n * @copyright  2025 Buendata <soluciones@buendata.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nlet htmlBuffer = '';\nlet rafPending = false;\n\nfunction typeWriter(element, text, speed) {\n  return new Promise((resolve) => {\n    let i = 0;\n    function typing() {\n      if (i < text.length) {\n        element.textContent += text.charAt(i);\n        i++;\n        setTimeout(typing, speed);\n      } else {\n        resolve();\n      }\n    }\n    typing();\n  });\n}\n\n/**\n * Start course streaming from the provided URL\n * @param {string} streamingUrl - The EventSource URL for streaming\n * @param {Element} container - Container element for displaying results\n * @returns {Promise} Promise that resolves when streaming is complete\n */\nexport const startStreaming = async (streamingUrl, container) => {\n    const progressIndicator = container.querySelector(\"[data-region='local_datacurso/course_streaming/progress']\");\n    const eventList = container.querySelector(\"[data-region='local_datacurso/course_streaming']\");\n    const progressIcon = container.querySelector(\"[data-region='local_datacurso/course_streaming/progress/icon']\");\n  \n    eventList.innerHTML = \"\";\n    if (progressIndicator) {\n      progressIndicator.style.display = \"block\";\n    }\n  \n    const evtSource = new EventSource(streamingUrl);\n  \n    evtSource.addEventListener('assistant_token', (event) => {\n      appendToken(event.data, eventList);\n    });\n\n    evtSource.addEventListener('assistant_message_end', () => {\n      progressIcon.innerHTML = `\n        <div class=\"bg-success rounded-circle d-flex align-items-center justify-content-center\" style=\"width: 1.5rem; height: 1.5rem;\">\n          <i class=\"text-white\" style=\"font-size: 0.8rem;\">âœ“</i>\n        </div>\n      `;\n      const planningActions = document.getElementById('course-planning-actions');\n      if (planningActions) {\n        planningActions.style.display = 'block';\n      }\n      evtSource.close();\n    });\n};\n\nfunction updateHtmlSoon(container) {\n  if (rafPending) return;\n  rafPending = true;\n  requestAnimationFrame(() => {\n    rafPending = false;\n    container.innerHTML = htmlBuffer;\n    container.scrollTop = container.scrollHeight;\n  });\n}\n\nfunction appendToken(token, container) {\n  htmlBuffer += token;\n  updateHtmlSoon(container);\n}\n  \n"],"names":["htmlBuffer","rafPending","async","streamingUrl","container","progressIndicator","querySelector","eventList","progressIcon","innerHTML","style","display","evtSource","EventSource","addEventListener","event","token","requestAnimationFrame","scrollTop","scrollHeight","updateHtmlSoon","appendToken","data","planningActions","document","getElementById","close"],"mappings":";;;;;;;;IAwBIA,WAAa,GACbC,YAAa,0BAwBaC,MAAOC,aAAcC,mBACzCC,kBAAoBD,UAAUE,cAAc,6DAC5CC,UAAYH,UAAUE,cAAc,oDACpCE,aAAeJ,UAAUE,cAAc,kEAE7CC,UAAUE,UAAY,GAClBJ,oBACFA,kBAAkBK,MAAMC,QAAU,eAG9BC,UAAY,IAAIC,YAAYV,cAElCS,UAAUE,iBAAiB,mBAAoBC,kBA4B9BC,MAAOZ,WAC1BJ,YAAcgB,eAXQZ,cAClBH,WAAY,OAChBA,YAAa,EACbgB,uBAAsB,KACpBhB,YAAa,EACbG,UAAUK,UAAYT,WACtBI,UAAUc,UAAYd,UAAUe,gBAMlCC,CAAehB,WA7BXiB,CAAYN,MAAMO,KAAMf,cAG1BK,UAAUE,iBAAiB,yBAAyB,KAClDN,aAAaC,sPAKPc,gBAAkBC,SAASC,eAAe,2BAC5CF,kBACFA,gBAAgBb,MAAMC,QAAU,SAElCC,UAAUc"}
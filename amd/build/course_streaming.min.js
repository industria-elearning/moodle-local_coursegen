define("local_datacurso/course_streaming",["exports","local_datacurso/repository/chatbot"],(function(_exports,_chatbot){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.startStreaming=_exports.startExecutionStreaming=void 0;
/**
   * Course Streaming Module for handling real-time course generation
   *
   * @module     local_datacurso/course_streaming
   * @copyright  2025 Buendata <soluciones@buendata.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
let htmlBuffer="",rafPending=!1;_exports.startStreaming=async(streamingUrl,container)=>{const progressIndicator=container.querySelector("[data-region='local_datacurso/course_streaming/progress']"),eventList=container.querySelector("[data-region='local_datacurso/course_streaming']"),progressIcon=container.querySelector("[data-region='local_datacurso/course_streaming/progress/icon']");eventList.innerHTML="",progressIndicator&&(progressIndicator.style.display="block");const evtSource=new EventSource(streamingUrl);evtSource.addEventListener("assistant_token",(event=>{!function(token,container){htmlBuffer+=token,function(container){if(rafPending)return;rafPending=!0,requestAnimationFrame((()=>{rafPending=!1,container.innerHTML=htmlBuffer,container.scrollTop=container.scrollHeight}))}(container)}(event.data,eventList)})),evtSource.addEventListener("assistant_message_end",(()=>{progressIcon.innerHTML='\n        <div class="bg-success rounded-circle d-flex align-items-center justify-content-center" style="width: 1.5rem; height: 1.5rem;">\n          <i class="text-white" style="font-size: 0.8rem;">‚úì</i>\n        </div>\n      ';const planningActions=document.getElementById("course-planning-actions");planningActions&&(planningActions.style.display="block"),evtSource.close()}))};const parseBest=raw=>{if(!raw)return null;const s=String(raw).trim();try{return JSON.parse(s)}catch(_){}try{let t=s.replace(/'/g,'"').replace(/\bNone\b/g,"null").replace(/\bTrue\b/g,"true").replace(/\bFalse\b/g,"false");return JSON.parse(t)}catch(_){return null}},addStatus=(message,type,container)=>{const statusDiv=document.createElement("div");statusDiv.className="alert alert-".concat("ok"===type?"success":"error"===type?"danger":"info"," mb-2"),statusDiv.innerHTML="<small>".concat(message,"</small>"),container.appendChild(statusDiv),container.scrollTop=container.scrollHeight};_exports.startExecutionStreaming=async(streamingUrl,container,courseid)=>{const progressIndicator=container.querySelector("[data-region='local_datacurso/course_streaming/progress']"),eventList=container.querySelector("[data-region='local_datacurso/course_streaming']"),progressIcon=container.querySelector("[data-region='local_datacurso/course_streaming/progress/icon']");console.log({container:container,progressIndicator:progressIndicator,eventList:eventList,progressIcon:progressIcon}),eventList.innerHTML="",progressIndicator&&(progressIndicator.style.display="block");const es=new EventSource(streamingUrl);es.addEventListener("execution_activity_start",(e=>{var _obj$index,_obj$section_index;console.log("onActStart",e);const obj=parseBest(e.data)||{},idx=null!==(_obj$index=obj.index)&&void 0!==_obj$index?_obj$index:"?",title=obj.title||"",sec=null!==(_obj$section_index=obj.section_index)&&void 0!==_obj$section_index?_obj$section_index:"?";addStatus("üß© Iniciando actividad #".concat(idx," (secci√≥n ").concat(sec,"): ").concat(title),"info",eventList)})),es.addEventListener("execution_activity_done",(e=>{var _obj$done,_obj$total,_obj$percent;console.log("onActDone",e);const obj=parseBest(e.data)||{},done=null!==(_obj$done=obj.done)&&void 0!==_obj$done?_obj$done:0,total=null!==(_obj$total=obj.total)&&void 0!==_obj$total?_obj$total:0,percent=null!==(_obj$percent=obj.percent)&&void 0!==_obj$percent?_obj$percent:0;addStatus("‚úÖ Actividad completada (".concat(done,"/").concat(total,") ‚Äî ").concat(percent,"%"),"ok",eventList)})),es.addEventListener("execution_progress",(e=>{var _obj$done2,_obj$total2,_obj$percent2;console.log("onProgress",e);const obj=parseBest(e.data)||{},done=null!==(_obj$done2=obj.done)&&void 0!==_obj$done2?_obj$done2:0,total=null!==(_obj$total2=obj.total)&&void 0!==_obj$total2?_obj$total2:0,percent=null!==(_obj$percent2=obj.percent)&&void 0!==_obj$percent2?_obj$percent2:0;addStatus("üìà Progreso: ".concat(done,"/").concat(total," (").concat(percent,"%)"),"info",eventList)})),es.addEventListener("execution_error",(e=>{console.log("onExecError",e),addStatus("‚ùå Error en una actividad","error",eventList)})),es.addEventListener("execution_complete",(async e=>{console.log("onComplete",e),es.close(),progressIcon.innerHTML='\n        <div class="bg-success rounded-circle d-flex align-items-center justify-content-center" style="width: 1.5rem; height: 1.5rem;">\n          <i class="text-white" style="font-size: 0.8rem;">‚úì</i>\n        </div>\n      ';try{const result=await(0,_chatbot.createCourse)({courseid:courseid});result.success?(addStatus("‚úÖ Curso creado exitosamente","ok",eventList),setTimeout((()=>{window.location.reload()}),500)):addStatus("‚ùå Error al crear el curso: ".concat(result.message),"error",eventList)}catch(error){addStatus("‚ùå Error al crear el curso: ".concat(error.message),"error",eventList)}}))}}));

//# sourceMappingURL=course_streaming.min.js.map
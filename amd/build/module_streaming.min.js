define("local_datacurso/module_streaming",["exports","core/str","local_datacurso/repository/chatbot"],(function(_exports,_str,_chatbot){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.startModuleStreaming=void 0;var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};const addStatus=(message,type,container)=>{const statusDiv=document.createElement("div");statusDiv.className="alert alert-".concat("success"===type?"success":"error"===type?"danger":"warning"===type?"warning":"info"," mb-2"),statusDiv.innerHTML="<small>".concat(message,"</small>"),container.appendChild(statusDiv),container.scrollTop=container.scrollHeight};_exports.startModuleStreaming=async function(streamingUrl,container){let params=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const progressIndicator=container.querySelector("[data-region='local_datacurso/course_streaming/progress']"),eventList=container.querySelector("[data-region='local_datacurso/course_streaming']"),progressIcon=container.querySelector("[data-region='local_datacurso/course_streaming/progress/icon']");eventList&&(eventList.innerHTML=""),progressIndicator&&(progressIndicator.style.display="block");const es=new EventSource(streamingUrl),onResourceStart=async e=>{console.log("onResourceStart",e);const message=await(0,_str.get_string)("module_streaming_start","local_datacurso");addStatus(message,"info",eventList)},onSchemaStart=async e=>{console.log("onSchemaStart",e);const message=await(0,_str.get_string)("module_streaming_schema_start","local_datacurso");addStatus(message,"info",eventList)},onSchemaDone=async e=>{console.log("onSchemaDone",e);const message=await(0,_str.get_string)("module_streaming_schema_done","local_datacurso");addStatus(message,"success",eventList)},onImagesStart=async e=>{console.log("onImagesStart",e);const message=await(0,_str.get_string)("module_streaming_images_start","local_datacurso");addStatus(message,"info",eventList)},onImagesDone=async e=>{console.log("onImagesDone",e);const message=await(0,_str.get_string)("module_streaming_images_done","local_datacurso");addStatus(message,"success",eventList)},onParametersStart=async e=>{console.log("onParametersStart",e);const message=await(0,_str.get_string)("module_streaming_parameters_start","local_datacurso");addStatus(message,"info",eventList)},onParametersDone=async e=>{console.log("onParametersDone",e);const message=await(0,_str.get_string)("module_streaming_parameters_done","local_datacurso");addStatus(message,"success",eventList)},onOutputStart=async e=>{console.log("onOutputStart",e);const message=await(0,_str.get_string)("module_streaming_output_start","local_datacurso");addStatus(message,"info",eventList)},onResourceComplete=async e=>{console.log("onResourceComplete",e),es.close(),progressIcon&&(progressIcon.innerHTML='\n        <div class="bg-success rounded-circle d-flex align-items-center justify-content-center" style="width: 1.5rem; height: 1.5rem;">\n          <i class="text-white" style="font-size: 0.8rem;">✓</i>\n        </div>\n      ');const completeMessage=await(0,_str.get_string)("module_streaming_complete","local_datacurso");addStatus(completeMessage,"success",eventList);try{const{createMod:createMod}=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["local_datacurso/repository/chatbot"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("local_datacurso/repository/chatbot")):Promise.resolve(_systemImportTransformerGlobalIdentifier["local_datacurso/repository/chatbot"])),response=await createMod({courseid:params.courseid,sectionnum:params.sectionnum,beforemod:params.beforemod,jobid:params.jobid});if(response&&response.ok){const successMessage=await(0,_str.get_string)("module_streaming_added_success","local_datacurso");addStatus(successMessage,"success",eventList),setTimeout((()=>{window.location.href=response.data.activityurl}),100)}else{const defaultError=await(0,_str.get_string)("module_streaming_add_error","local_datacurso"),msg=response&&response.message?response.message:defaultError;addStatus("⚠️ ".concat(msg),"error",eventList)}}catch(err){console.error("Error al crear la actividad desde resource_complete:",err);const errorMessage=await(0,_str.get_string)("module_streaming_add_problem","local_datacurso",(null==err?void 0:err.message)||err);addStatus("⚠️ ".concat(errorMessage),"error",eventList)}},onError=async e=>{console.error("Streaming error:",e),es.close();const errorMessage=await(0,_str.get_string)("module_streaming_creation_error","local_datacurso");addStatus(errorMessage,"error",eventList)},generateImages=Number(params.generateimages)||0;es.addEventListener("resource_start",onResourceStart),es.addEventListener("resource_schema_start",onSchemaStart),es.addEventListener("resource_schema_done",onSchemaDone),1===generateImages&&(es.addEventListener("resource_images_start",onImagesStart),es.addEventListener("resource_images_done",onImagesDone)),es.addEventListener("resource_parameters_start",onParametersStart),es.addEventListener("resource_parameters_done",onParametersDone),es.addEventListener("resource_output_start",onOutputStart),es.addEventListener("resource_complete",onResourceComplete),es.addEventListener("error",onError)}}));

//# sourceMappingURL=module_streaming.min.js.map
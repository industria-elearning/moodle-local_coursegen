define("local_datacurso/module_streaming",["exports","core/str"],(function(_exports,_str){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.startModuleStreaming=void 0;var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};const parseBest=raw=>{if(!raw)return null;const s=String(raw).trim();try{return JSON.parse(s)}catch(_){}try{let t=s.replace(/'/g,'"').replace(/\bNone\b/g,"null").replace(/\bTrue\b/g,"true").replace(/\bFalse\b/g,"false");return JSON.parse(t)}catch(_){return null}},addStatus=(message,type,container)=>{const statusDiv=document.createElement("div");statusDiv.className="alert alert-".concat("success"===type?"success":"error"===type?"danger":"warning"===type?"warning":"info"," mb-2"),statusDiv.innerHTML="<small>".concat(message,"</small>"),container.appendChild(statusDiv),container.scrollTop=container.scrollHeight};_exports.startModuleStreaming=async function(streamingUrl,container){let params=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const progressIndicator=container.querySelector("[data-region='local_datacurso/module_streaming/progress']"),eventList=container.querySelector("[data-region='local_datacurso/module_streaming']"),progressIcon=container.querySelector("[data-region='local_datacurso/module_streaming/progress/icon']");console.log("Starting module streaming:",{streamingUrl:streamingUrl,container:container,params:params}),eventList&&(eventList.innerHTML=""),progressIndicator&&(progressIndicator.style.display="block");const es=new EventSource(streamingUrl),onResourceStart=async e=>{console.log("onResourceStart",e);parseBest(e.data);addStatus("Iniciando creación del módulo...","info",eventList)},onIntentContextStart=async e=>{console.log("onIntentContextStart",e),addStatus("Analizando intención y contexto...","info",eventList)},onIntentContextDone=async e=>{console.log("onIntentContextDone",e),addStatus("✓ Intención y contexto analizados","success",eventList)},onSchemaStart=async e=>{console.log("onSchemaStart",e),addStatus("Generando esquema del módulo...","info",eventList)},onSchemaDone=async e=>{console.log("onSchemaDone",e),addStatus("✓ Esquema del módulo generado","success",eventList)},onDateStart=async e=>{console.log("onDateStart",e),addStatus("Procesando fechas...","info",eventList)},onDateDone=async e=>{console.log("onDateDone",e),addStatus("✓ Fechas procesadas","success",eventList)},onParametersStart=async e=>{console.log("onParametersStart",e),addStatus("Configurando parámetros...","info",eventList)},onParametersDone=async e=>{console.log("onParametersDone",e),addStatus("✓ Parámetros configurados","success",eventList)},onImagesStart=async e=>{console.log("onImagesStart",e),addStatus("Generando imágenes...","info",eventList)},onImagesDone=async e=>{console.log("onImagesDone",e),addStatus("✓ Imágenes generadas","success",eventList)},onOutputStart=async e=>{console.log("onOutputStart",e),addStatus("Preparando salida final...","info",eventList)},onOutputDone=async e=>{console.log("onOutputDone",e),addStatus("✓ Salida preparada","success",eventList)},onResourceComplete=async e=>{console.log("onResourceComplete",e),es.close(),progressIcon&&(progressIcon.innerHTML='\n        <div class="bg-success rounded-circle d-flex align-items-center justify-content-center" style="width: 1.5rem; height: 1.5rem;">\n          <i class="text-white" style="font-size: 0.8rem;">✓</i>\n        </div>\n      '),addStatus("✓ Generación del módulo completada","success",eventList);try{const{createMod:createMod}=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["local_datacurso/repository/chatbot"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("local_datacurso/repository/chatbot")):Promise.resolve(_systemImportTransformerGlobalIdentifier["local_datacurso/repository/chatbot"])),response=await createMod({courseid:params.courseid,sectionnum:params.sectionnum,beforemod:params.beforemod,prompt:"",generateimages:0,jobid:params.jobid});if(response&&response.ok)addStatus("✓ Módulo creado exitosamente","success",eventList);else{const msg=response&&response.message?response.message:"No se pudo crear el módulo.";addStatus("❌ ".concat(msg),"error",eventList)}}catch(err){console.error("Error al crear el módulo desde resource_complete:",err),addStatus("❌ Error creando el módulo: ".concat((null==err?void 0:err.message)||err),"error",eventList)}},onError=async e=>{console.error("Streaming error:",e),es.close(),addStatus("❌ Error en la creación del módulo","error",eventList)};es.addEventListener("resource_start",onResourceStart),es.addEventListener("resource_intent_context_start",onIntentContextStart),es.addEventListener("resource_intent_context_done",onIntentContextDone),es.addEventListener("resource_schema_start",onSchemaStart),es.addEventListener("resource_schema_done",onSchemaDone),es.addEventListener("resource_date_start",onDateStart),es.addEventListener("resource_date_done",onDateDone),es.addEventListener("resource_parameters_start",onParametersStart),es.addEventListener("resource_parameters_done",onParametersDone),es.addEventListener("resource_images_start",onImagesStart),es.addEventListener("resource_images_done",onImagesDone),es.addEventListener("resource_output_start",onOutputStart),es.addEventListener("resource_output_done",onOutputDone),es.addEventListener("resource_complete",onResourceComplete),es.addEventListener("error",onError)}}));

//# sourceMappingURL=module_streaming.min.js.map
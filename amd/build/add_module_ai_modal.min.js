define("local_datacurso/add_module_ai_modal",["exports","core/modal","core/templates","core/notification","core/str","local_datacurso/module_streaming","core/ajax"],(function(_exports,_modal,_templates,_notification,_str,_module_streaming,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Module AI Modal Module using Moodle's modal factory
   *
   * @module     local_datacurso/add_module_ai_modal
   * @copyright  2025 Buendata <soluciones@buendata.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modal=_interopRequireDefault(_modal),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_ajax=_interopRequireDefault(_ajax);let currentModal=null;_exports.init=async function(){let params=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{currentModal&&(currentModal.destroy(),currentModal=null);const[title,bodyHTML]=await Promise.all([(0,_str.get_string)("addmoduleai_modaltitle","local_datacurso"),_templates.default.render("local_datacurso/add_module_ai_modal",{})]);currentModal=await _modal.default.create({title:title,body:bodyHTML,large:!0,scrollable:!0,removeOnClose:!0}),currentModal.getRoot().addClass("local_datacurso_module_ai_modal"),currentModal.show();const bodyEl=currentModal.getBody()[0];return initializeModuleForm(bodyEl,params),currentModal}catch(error){return _notification.default.exception(error),null}};const initializeModuleForm=async(container,params)=>{const form=container.querySelector("#module-creation-form"),promptInput=container.querySelector("#modulePromptInput"),generateImagesCheckbox=container.querySelector("#generateImagesCheckbox"),submitBtn=container.querySelector("#create-module-btn"),streamingContainer=container.querySelector("#module-streaming-container");form&&promptInput&&submitBtn&&(promptInput.focus(),promptInput.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),form.dispatchEvent(new Event("submit")))})),form.addEventListener("submit",(async e=>{e.preventDefault();const prompt=promptInput.value.trim();if(!prompt)return void promptInput.focus();submitBtn.disabled=!0;const originalText=submitBtn.textContent;submitBtn.textContent=await(0,_str.get_string)("creating_module","local_datacurso"),form.style.display="none",streamingContainer.style.display="block";try{const response=await _ajax.default.call([{methodname:"local_datacurso_create_mod_stream",args:{courseid:params.courseid,sectionnum:params.sectionnum||null,prompt:prompt,generateimages:generateImagesCheckbox&&generateImagesCheckbox.checked?1:0,beforemod:params.beforemod||null}}])[0];if(!response.ok)throw new Error(response.message||await(0,_str.get_string)("error_creating_module","local_datacurso"));const baseurl=M.cfg.wwwroot.replace(/\/$/,""),streamingUrl="".concat(baseurl,"/local/datacurso/streaming_proxy.php?endpoint=resources/create-mod/stream&job_id=").concat(response.job_id),html=await _templates.default.render("local_datacurso/module_streaming_inline",{title:await(0,_str.get_string)("module_creating_title","local_datacurso"),subtitle:await(0,_str.get_string)("module_creating_subtitle","local_datacurso")});streamingContainer.innerHTML=html,await(0,_module_streaming.startModuleStreaming)(streamingUrl,streamingContainer)}catch(error){console.error("Error creating module:",error),form.style.display="block",streamingContainer.style.display="none",submitBtn.disabled=!1,submitBtn.textContent=originalText,_notification.default.exception(error)}})))}}));

//# sourceMappingURL=add_module_ai_modal.min.js.map